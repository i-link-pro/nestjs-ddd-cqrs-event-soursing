import { BaseEntity } from './base-entity';
import { DomainEvent } from '../../shared/domain/domain-event';

/**
 * –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –¥–ª—è –∫–æ—Ä–Ω–µ–π –∞–≥—Ä–µ–≥–∞—Ç–æ–≤ –≤ DDD
 * 
 * –ê–≥—Ä–µ–≥–∞—Ç - —ç—Ç–æ –≥—Ä—É–ø–ø–∞ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π, –∫–æ—Ç–æ—Ä—ã–µ —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞—é—Ç—Å—è 
 * –∫–∞–∫ –µ–¥–∏–Ω–æ–µ —Ü–µ–ª–æ–µ –¥–ª—è —Ü–µ–ª–µ–π –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö.
 * 
 * –ö–æ—Ä–µ–Ω—å –∞–≥—Ä–µ–≥–∞—Ç–∞ - —ç—Ç–æ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è —Å—É—â–Ω–æ—Å—Ç—å, —á–µ—Ä–µ–∑ –∫–æ—Ç–æ—Ä—É—é 
 * –≤–Ω–µ—à–Ω–∏–µ –æ–±—ä–µ–∫—Ç—ã –º–æ–≥—É—Ç —Å—Å—ã–ª–∞—Ç—å—Å—è –Ω–∞ –ª—é–±—ã–µ –æ–±—ä–µ–∫—Ç—ã –≤–Ω—É—Ç—Ä–∏ –∞–≥—Ä–µ–≥–∞—Ç–∞.
 * 
 * –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã:
 * - –¢–æ–ª—å–∫–æ –∫–æ—Ä–µ–Ω—å –∞–≥—Ä–µ–≥–∞—Ç–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–ª—É—á–µ–Ω —á–µ—Ä–µ–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
 * - –û–±—ä–µ–∫—Ç—ã –≤–Ω–µ –∞–≥—Ä–µ–≥–∞—Ç–∞ –Ω–µ –º–æ–≥—É—Ç —Å—Å—ã–ª–∞—Ç—å—Å—è –Ω–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –æ–±—ä–µ–∫—Ç—ã
 * - –ö–æ—Ä–µ–Ω—å –∞–≥—Ä–µ–≥–∞—Ç–∞ –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç–Ω–æ—Å—Ç—å –∞–≥—Ä–µ–≥–∞—Ç–∞
 * - –î–æ–º–µ–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è –ø—É–±–ª–∏–∫—É—é—Ç—Å—è —á–µ—Ä–µ–∑ –∫–æ—Ä–µ–Ω—å –∞–≥—Ä–µ–≥–∞—Ç–∞
 */
export abstract class AggregateRoot extends BaseEntity {
  private _domainEvents: DomainEvent[] = [];

  /**
   * –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –¥–æ–º–µ–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
   */
  public get domainEvents(): DomainEvent[] {
    return [...this._domainEvents];
  }

  /**
   * –î–æ–±–∞–≤–∏—Ç—å –¥–æ–º–µ–Ω–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ
   * –°–æ–±—ã—Ç–∏—è –±—É–¥—É—Ç –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω—ã –ø–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∞–≥—Ä–µ–≥–∞—Ç–∞
   */
  protected addDomainEvent(event: DomainEvent): void {
    this._domainEvents.push(event);
    console.log(`üì¢ –î–æ–º–µ–Ω–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ: ${event.constructor.name}`);
  }

  /**
   * –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –¥–æ–º–µ–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
   * –û–±—ã—á–Ω–æ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ —Å–æ–±—ã—Ç–∏–π
   */
  public clearDomainEvents(): void {
    this._domainEvents = [];
  }

  /**
   * –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –µ—Å—Ç—å –ª–∏ –Ω–µ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
   */
  public hasUnpublishedEvents(): boolean {
    return this._domainEvents.length > 0;
  }

  /**
   * –ü–æ–º–µ—Ç–∏—Ç—å –∞–≥—Ä–µ–≥–∞—Ç –∫–∞–∫ –∏–∑–º–µ–Ω–µ–Ω–Ω—ã–π
   * –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –ª—é–±–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∞–≥—Ä–µ–≥–∞—Ç–∞
   */
  protected markAsModified(): void {
    this.touch();
  }
} 